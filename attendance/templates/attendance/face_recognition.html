<!-- filepath: /C:/Users/deves/OneDrive/Desktop/tet/New folder (6)/AttendenceSystem/ai-attendance-system/attendance/templates/attendance/face_recognition.html -->
{% extends 'attendance/base.html' %}

{% block title %}Face Recognition{% endblock %}

{% block content %}
<h1>Face Recognition</h1>
<form method="post" action="{% url 'face_recognition_attendance' %}" enctype="multipart/form-data">
    {% csrf_token %}
    <label for="ip_cam_url">IP Camera URL:</label>
    <input type="text" id="ip_cam_url" name="ip_cam_url" required>
    <br>
    <label for="student_id">Select Student:</label>
    <select id="student_id" name="student_id" required>
        {% for student in students %}
        <option value="{{ student.id }}">{{ student.student_name }}</option>
        {% endfor %}
    </select>
    <br>
    <video id="video" width="640" height="480" autoplay></video>
    <br>
    <button type="button" id="capture">Capture Image</button>
    <br>
    <input type="hidden" id="captured_image" name="captured_image">
    <button type="submit">Start Face Recognition</button>
</form>

<script>
    // Access the camera and display the video stream
    const video = document.getElementById('video');
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
            video.srcObject = stream;
        })
        .catch(err => {
            console.error('Error accessing the camera: ', err);
        });

    // Capture the image from the video stream
    document.getElementById('capture').addEventListener('click', () => {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const context = canvas.getContext('2d');
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const dataUrl = canvas.toDataURL('image/png');
        document.getElementById('captured_image').value = dataUrl;
    });
</script>
{% endblock %}